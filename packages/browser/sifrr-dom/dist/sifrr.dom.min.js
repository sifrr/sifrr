/*! Sifrr.Dom v0.0.2-alpha - sifrr project | MIT licensed | https://github.com/sifrr/sifrr */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@sifrr/fetch")):"function"==typeof define&&define.amd?define(["@sifrr/fetch"],t):((e=e||self).Sifrr=e.Sifrr||{},e.Sifrr.Dom=t(e.Sifrr.Fetch))}(this,function(e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;const t=window.document.createElement("template"),n=window.document.createElement("script");var r={TEMPLATE:()=>t.cloneNode(!1),SCRIPT:()=>n.cloneNode(!1),TEXT_NODE:3,COMMENT_NODE:8,ELEMENT_NODE:1,OUTER_REGEX:new RegExp("(\\${(?:(?:[^{}$]|{(?:[^{}$])*})*)})","g"),HTML_ATTR:"data-sifrr-html",REPEAT_ATTR:"data-sifrr-repeat",KEY_ATTR:"data-sifrr-key"};const o=window.document.createTreeWalker(window.document,window.NodeFilter.SHOW_ALL,null,!1),{HTML_ATTR:i}=r;function s(e){return e.hasAttribute&&e.hasAttribute(i)}o.nextNonfilterNode=function(e){return e=s(e)?this.nextSibling()||(this.parentNode(),this.nextSibling()):this.nextNode()},o.roll=function(e){let t=this.currentNode;for(;--e;)t=this.nextNonfilterNode(t);return t},o.rollSimple=function(e){let t;for(;--e;)t=this.nextNode();return t||this.currentNode};var l={collect:function(e,t){const n=[],r=t.length;o.currentNode=e;for(let e=0;e<r;e++)n.push(o.roll(t[e].idx));return n},collectSimple:function(e,t){const n=[],r=t.length;o.currentNode=e;for(let e=0;e<r;e++)n.push(o.rollSimple(t[e].idx));return n},create:function(e,t,n=!0){let r,i=[],l=0;for(o.currentNode=e;e;)(r=t(e,s,n))?(i.push({idx:l+1,ref:r}),l=1):l++,e=o.nextNonfilterNode(e,n);return i}};const{TEMPLATE:a}=r;var c=(e,...t)=>{const n=a();if("string"==typeof e);else{if(!e[0]||"string"!=typeof e[0])return e[0]?(Array.from(e).forEach(e=>{n.content.appendChild(e)}),n):e.nodeType&&!e.content?(n.content.appendChild(e),n):e;e=String.raw(e,...t)}return e=e.replace(/>\n+/g,">").replace(/\s+</g,"<").replace(/>\s+/g,">").replace(/(\\)?\$(\\)?\{/g,"${"),n.innerHTML=e,n},u=(e,t,n)=>{const r=e.getAttribute(t);!1===n||null==n?e.removeAttribute(t):r!==n&&("class"===t?e.className=n:e.setAttribute(t,n)),"value"!=t||"SELECT"!=e.nodeName&&"INPUT"!=e.nodeName||(e.value=n)};var d={shallowEqual:(e,t)=>{for(let n in e)if(!(n in t)||e[n]!==t[n])return!1;for(let n in t)if(!(n in e)||e[n]!==t[n])return!1;return!0}};const{shallowEqual:h}=d,{TEXT_NODE:f,COMMENT_NODE:m}=r;function p(e,t,n){const r=e.childNodes.length,o=t.length;if(0===o)return void(e.textContent="");if(0===r){let r;for(let i=0;i<o;i++)r=t[i],t[i].nodeType||(r=n(t[i])),e.appendChild(r);return}if(r>o){let t=r;for(;t>o;)e.removeChild(e.lastChild),t--}else if(r<o){let i,s=r;for(;s<o;)i=t[s],t[s].nodeType||(i=n(t[s])),e.appendChild(i),s++}const i=Math.min(o,r);for(let n,r=0,o=e.firstChild;r<i;r++)o=g(o,n=t[r]).nextSibling}function g(e,t){if(!t.nodeType)return h(e.state,t)||(e.state=t),e;if(e.nodeName!==t.nodeName)return e.replaceWith(t),t;if(e.nodeType===f||e.nodeType===m)return e.data!==t.data&&(e.data=t.data),e;t.state&&(e.state=t.state);let n,r=e.attributes,o=t.attributes;for(let t=o.length-1;t>=0;--t)u(e,o[t].name,o[t].value);for(let o=r.length-1;o>=0;--o)n=r[o],t.hasAttribute(n.name)||e.removeAttribute(n.name);return p(e,Array.prototype.slice.call(t.childNodes)),e}var E={makeEqual:g,makeChildrenEqual:p};const{makeEqual:w}=E;function y(e,t){let n=[],r=[],o=-1,i=new Array(e.length);for(let s=t,l=e.length;s<l;s++){let t=e[s];if(t<0)continue;let l=S(n,t);-1!==l&&(i[s]=r[l]),l===o?(n[++o]=t,r[o]=s):t<n[l+1]&&(n[l+1]=t,r[l+1]=s)}for(let e=r[o];o>=0;e=i[e],o--)n[o]=e;return n}function S(e,t){let n=-1,r=e.length;if(r>0&&e[r-1]<=t)return r-1;for(;r-n>1;){let o=Math.floor((n+r)/2);e[o]>t?r=o:n=o}return n}var b={makeChildrenEqualKeyed:function(e,t,n=(e=>e),r){const o=t.length;if(0===o)return void(e.textContent="");const i=e.childNodes.length;if(0===i){for(let r=0;r<o;r++)e.appendChild(n(t[r]));return}const s=[];let l=e.firstChild;for(;l;)s.push(l.state),l=l.nextSibling;let a,c,u,d=0,h=0,f=!0,m=i-1,p=o-1,g=e.firstChild,E=e.lastChild;e:for(;f;){for(f=!1,c=s[d],u=t[h];c[r]===u[r];){if(w(g,u),d++,g=g.nextSibling,h++,m<d||p<h)break e;c=s[d],u=t[h]}for(c=s[m],u=t[p];c[r]===u[r];){if(w(E,u),m--,a=E,E=E.previousSibling,p--,m<d||p<h)break e;c=s[m],u=t[p]}for(c=s[m],u=t[h];c[r]===u[r];){if(f=!0,w(E,u),l=E.previousSibling,e.insertBefore(E,g),E=l,h++,--m<d||p<h)break e;c=s[m],u=t[h]}for(c=s[d],u=t[p];c[r]===u[r];){if(f=!0,w(g,u),l=g.nextSibling,e.insertBefore(g,E.nextSibling),a=g,E=g.previousSibling,g=l,p--,m<++d||p<h)break e;c=s[d],u=t[p]}}if(p<h){if(d<=m){let t;for(;d<=m;)0===m?e.removeChild(E):(t=E.previousSibling,e.removeChild(E),E=t),m--}return}if(m<d){if(h<=p)for(;h<=p;)l=n(t[h]),e.insertBefore(l,E.nextSibling),E=l,h++;return}const S=new Array(p+1-h),b=new Map,v=[];for(let e=h;e<=p;e++)S[e]=-1,b.set(t[e][r],e);let _=0;for(let e=d;e<=m;e++)b.has(s[e][r])?(S[b.get(s[e][r])]=e,_++):v.push(e);if(0===_){for(let r=h;r<=p;r++)r>m?e.insertBefore(n(t[r]),g):(l=g.nextSibling,g.replaceWith(n(t[r])),g=l);if(p<m)for(;p<m;)l=E.previousSibling,e.removeChild(E),E=l,m--;return}const T=y(S,h),N=[];for(;d<=m;)N[d]=g,g=g.nextSibling,d++;let x,C=T.length-1;for(let r=p;r>=h;r--)T[C]===r?(a=N[S[r]],w(a,t[r]),C--):(-1===S[r]?x=n(t[r]):(x=N[S[r]],w(x,t[r])),e.insertBefore(x,a),a=x);for(let t=0;t<v.length;t++)e.removeChild(N[v[t]])},longestPositiveIncreasingSubsequence:y};const{OUTER_REGEX:v}=r;function _(e){let t;t=e.indexOf("return ")>=0?e:"return "+e;try{return new Function(t)}catch(e){return window.console.log(`Error processing binding: \`${t}\``),""}}function T(e,t){try{return"string"==typeof e?e:e.call(t)}catch(n){const r=e.toString();window.console.log(`Error evaluating: \`${r.slice(r.indexOf("{")+1,r.lastIndexOf("}"))}\` for element`,t),window.console.error(n)}}var N={getBindingFxns:e=>{const t=e.split(v),n=t.length,r=[];for(let e=0;e<n;e++)"$"===t[e][0]&&"{"===t[e][1]?r.push(_(t[e].slice(2,-1))):t[e]&&r.push(t[e]);return r},evaluateBindings:(e,t)=>1===e.length?T(e[0],t):e.map(e=>T(e,t)).join(""),evaluate:T,replacer:_};const{makeChildrenEqual:x}=E,{makeChildrenEqualKeyed:C}=b,{evaluateBindings:A}=N,{TEMPLATE:O,KEY_ATTR:M}=r;var $=function(e,t){if(!e._refs)return!1;t=t||e.constructor.stateMap;const n=e._refs.length;for(let r=0;r<n;r++){const n=t[r].ref,o=e._refs[r];if(n.attributes)for(let t in n.attributes)if("events"!==t){const r=A(n.attributes[t],e);u(o,t,r)}else{for(let t in n.attributes.events){const r=A(n.attributes.events[t],e);o[t]=r}o._root=e}if(void 0===n.text)continue;const i=A(n.text,e);if(0===n.type)o.data!=i&&(o.data=i);else if(2===n.type){const e=o.getAttribute(M);e?C(o,i,e=>n.se.sifrrClone(!0,e),e):x(o,i,e=>n.se.sifrrClone(!0,e))}else{let e;if(Array.isArray(i))e=i;else if(i.content&&11===i.content.nodeType)e=Array.prototype.slice.call(i.content.childNodes);else if(i.nodeType)e=[i];else if("string"==typeof i){const t=O();t.innerHTML=i.toString(),e=Array.prototype.slice.call(t.content.childNodes)}else e=Array.prototype.slice.call(i);x(o,e)}}e.onUpdate&&e.onUpdate()};var R=function(e,t=null){if(!(e.nodeType||"string"==typeof e||e[0]&&e[0].nodeType))throw TypeError("First argument for SimpleElement should be of type string or DOM element");const n=c(e);if((e=n.content.firstElementChild||n.content.firstChild).isSifrr||-1!==e.nodeName.indexOf("-")||e.getAttribute&&e.getAttribute("is")&&-1!==e.getAttribute("is").indexOf("-"))return e;const r=X.createStateMap(e,!1);function o(e){e._refs=X.collectRefsSimple(e,r),Object.defineProperty(e,"state",{get:()=>e._state,set:t=>{e._state=Object.assign(e._state||{},t),$(e,r)}})}return o(e),t&&(e.state=t),e.sifrrClone=function(t=!0,n){const r=e.cloneNode(t);return o(r),n?r.state=n:e.state&&(r.state=e.state),r},e};const{getBindingFxns:L}=N;var j=(e,t,n)=>{e.type=2,e.se=R(t.childNodes),e.text=L(t.getAttribute(n)),t.textContent="",t.removeAttribute(n)};const{TEXT_NODE:q,COMMENT_NODE:k,ELEMENT_NODE:P,REPEAT_ATTR:U}=r,{getBindingFxns:D}=N;var H={creator:function(e,t,n){if(e.nodeType===q||e.nodeType===k){const t=e.data;if(t.indexOf("${")>-1)return{type:0,text:D(t.trim())}}else if(e.nodeType===P){const r={};if(n)if(t(e)){const t=e.innerHTML;t.indexOf("${")>=0&&(r.type=1,r.text=D(t.replace(/<!--((?:(?!-->).)+)-->/g,"$1").trim()))}else e.hasAttribute(U)&&j(r,e,U);const o=e.attributes,i=o.length,s={events:{}};for(let e=0;e<i;e++){const t=o[e];"_"===t.name[0]?s.events[t.name]=D(t.value):t.value.indexOf("${")>=0&&(s[t.name]=D(t.value))}if(0===Object.keys(s.events).length&&delete s.events,Object.keys(s).length>0&&(r.attributes=s),Object.keys(r).length>0)return r}return 0}};const{collect:B,create:F,collectSimple:W}=l,{creator:I}=H;var X={collectRefs:B,collectRefsSimple:W,createStateMap:(e,t)=>F(e,I,t),twoWayBind:e=>{const t=e.composedPath?e.composedPath()[0]:e.target;if(!t.hasAttribute("data-sifrr-bind")||null===t._root)return;const n=t.value||t.textContent;let r={};if(!t._root){let e;for(e=t;e&&!e.isSifrr;)e=e.parentNode||e.host;t._root=e||null}r[t.getAttribute("data-sifrr-bind")]=n,t._root&&(t._root.state=r)}};class K{constructor(t,n){if(!e)throw Error("Sifrr.Dom.load requires Sifrr.Fetch to work.");if(this.constructor.all[t])return this.constructor.all[t];this.elementName=t,this.url=n}get html(){if(this._html)return this._html;K.add(this.elementName,this);const t=this;return this._html=e.file(this.htmlUrl).then(e=>e.text()).then(e=>c(e).content).then(e=>(t.template=e.querySelector("template"),e)),this._html}get js(){return this._js?this._js:(K.add(this.elementName,this),this._js=e.file(this.jsUrl).then(e=>e.text()),this._js)}get htmlUrl(){return this.url||`${window.Sifrr.Dom.config.baseUrl+"/"}elements/${this.elementName.split("-").join("/")}.html`}get jsUrl(){return this.url||`${window.Sifrr.Dom.config.baseUrl+"/"}elements/${this.elementName.split("-").join("/")}.js`}executeScripts(e){return this._executed?window.console.log(`'${this.elementName}' element's javascript was already executed`):(this._executed=!0,e?this.js.then(e=>{new Function(e+`\n //# sourceURL=${this.jsUrl}`).call()}).catch(e=>(window.console.error(e),window.console.log(`JS file for '${this.elementName}' gave error. Trying to get html file.`),this.executeHTMLScripts())):this.executeHTMLScripts())}executeHTMLScripts(){return this.html.then(e=>{e.querySelectorAll("script").forEach(t=>{if(t.src){const e=r.SCRIPT();e.src=t.src,e.type=t.type,window.document.body.appendChild(e)}else new Function(t.text+`\n //# sourceURL=${this.htmlUrl}`).call({currentTempate:e.querySelector("template")})})}).catch(e=>{throw e})}static add(e,t){K._all[e]=t}static get all(){return K._all}}K._all={};var G=K;const{makeChildrenEqual:J}=E;var Y=function e(t){return class extends t{static extends(t){return e(t)}static get observedAttributes(){return["data-sifrr-state"].concat(this.observedAttrs())}static observedAttrs(){return[]}static get template(){return(G.all[this.elementName]||{template:!1}).template}static get ctemp(){return this._ctemp=this._ctemp||this.template,window.ShadyCSS&&this.useShadowRoot&&!this._ctemp.shady&&(window.ShadyCSS.prepareTemplate(this._ctemp,this.elementName),this._ctemp.shady=!0),this._ctemp}static get stateMap(){return this._stateMap=this._stateMap||X.createStateMap(this.ctemp.content),this._stateMap}static get elementName(){return this.name.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}static get useShadowRoot(){return this.useSR}constructor(){if(super(),this.constructor.ctemp){this._state=Object.assign({},this.constructor.defaultState,this.state);const e=this.constructor.stateMap,t=this.constructor.ctemp.content.cloneNode(!0);this._refs=X.collectRefs(t,e),this.constructor.useShadowRoot?(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(t)):this.__content=t}}connectedCallback(){!this.constructor.useShadowRoot&&this.__content&&(J(this,Array.prototype.slice.call(this.__content.childNodes)),delete this.__content),this.hasAttribute("data-sifrr-state")||this.update(),this.onConnect()}onConnect(){}disconnectedCallback(){this.onDisconnect()}onDisconnect(){}attributeChangedCallback(e,t,n){"data-sifrr-state"===e&&(this.state=JSON.parse(n)),this.onAttributeChange(e,t,n)}onAttributeChange(){}get state(){return this._state}set state(e){this._state!==e&&Object.assign(this._state,e),this.update(),this.onStateChange()}onStateChange(){}update(){$(this)}onUpdate(){}isSifrr(e=null){return!e||e===this.constructor.elementName}sifrrClone(e,t){const n=this.cloneNode(e);return n._state=t,n}clearState(){this._state={},this.update()}$(e,t=!0){return this.constructor.useShadowRoot&&t?this.shadowRoot.querySelector(e):this.querySelector(e)}$$(e,t=!0){return this.constructor.useShadowRoot&&t?this.shadowRoot.querySelectorAll(e):this.querySelectorAll(e)}}}(window.HTMLElement);const z={},Z={capture:!0,passive:!0},Q=(e,t)=>Promise.resolve((()=>{const n=e.composedPath?e.composedPath()[0]:e.target;let r=n;for(;r;){const o=r[`_${t}`]||(r.getAttribute?r.getAttribute(`_${t}`):null);"function"==typeof o?o.call(r._root||window,e,n):"string"==typeof o&&new Function("event","target",o).call(r._root||window,event,n),V(e,t,r,n),r=r.parentNode||r.host}})()),V=(e,t,n,r)=>{function o(t){t.forEach(t=>t(e,r,n))}for(let e in z[t])("function"==typeof n.matches&&n.matches(e)||9===n.nodeType&&"document"===e)&&o(z[t][e])};var ee={all:z,add:e=>!z[e]&&(window.addEventListener(e,t=>Q(t,e),Z),z[e]={},!0),addListener:(e,t,n)=>{const r=z[e][t]||[];return r.indexOf(n)<0&&r.push(n),z[e][t]=r,!0},removeListener:(e,t,n)=>{const r=z[e][t]||[],o=r.indexOf(n);return o>=0&&r.splice(o,1),z[e][t]=r,!0},trigger:(e,t,n)=>{"string"==typeof e&&(e=document.querySelector(e)),e.dispatchEvent(new window.Event(t,Object.assign({bubbles:!0,composed:!0},n)))},opts:Z,nativeToSyntheticEvent:Q};let te={elements:{},loadingElements:[]};return te.Element=Y,te.Parser=X,te.Loader=G,te.SimpleElement=R,te.Event=ee,te.makeEqual=E,te.template=c,te.register=((e,t)=>{e.useSR=te.config.useShadowRoot;const n=e.elementName;if(!n)throw Error("Error creating Custom Element: No name given.",e);if(window.customElements.get(n))throw Error(`Error creating Element: ${n} - Custom Element with this name is already defined.`);if(n.indexOf("-")<1)throw Error(`Error creating Element: ${n} - Custom Element name must have one dash '-'`);try{return window.customElements.define(n,e,t),te.elements[n]=e,!0}catch(e){return window.console.error(`Error creating Custom Element: ${n} - ${e.message}`,e.trace),!1}}),te.setup=function(e){if(HTMLElement.prototype.$=HTMLElement.prototype.querySelector,HTMLElement.prototype.$$=HTMLElement.prototype.querySelectorAll,te.config=Object.assign({baseUrl:"",useShadowRoot:!0},e),"string"!=typeof te.config.baseUrl)throw Error("baseUrl should be a string");te.Event.add("input"),te.Event.add("change"),te.Event.addListener("input","document",te.Parser.twoWayBind),te.Event.addListener("change","document",te.Parser.twoWayBind)},te.load=function(e,{url:t,js:n=!0}={}){if(window.customElements.get(e))return window.console.warn(`Error loading Element: ${e} - Custom Element with this name is already defined.`);let r=new te.Loader(e,t);const o=customElements.whenDefined(e);return te.loadingElements.push(o),r.executeScripts(n).then(()=>{window.customElements.get(e)||window.console.warn(`Executing '${e}' file didn't register the element. Ignore if you are registering element in a promise or async function.`)}).catch(e=>{te.loadingElements.splice(te.loadingElements.indexOf(o),1),window.console.error(e)})},te.loading=(()=>Promise.all(te.loadingElements)),te});
/*! (c) @aadityataparia */
//# sourceMappingURL=sifrr.dom.min.js.map
