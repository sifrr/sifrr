/*! Sifrr.Dom v0.0.5 - sifrr project | MIT licensed | https://github.com/sifrr/sifrr */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):((t=t||self).Sifrr=t.Sifrr||{},t.Sifrr.Dom=e())}(this,function(){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};const e=window.document.createElement("template"),n=window.document.createElement("script");var r={TEMPLATE:()=>e.cloneNode(!1),SCRIPT:()=>n.cloneNode(!1),TREE_WALKER:()=>window.document.createTreeWalker(window.document,window.NodeFilter.SHOW_ALL,null,!1),TEXT_NODE:3,COMMENT_NODE:8,ELEMENT_NODE:1,OUTER_REGEX:new RegExp("(\\${(?:(?:[^{}$]|{(?:[^{}$])*})*)})","g"),STATE_REGEX:/^\$\{this\.state\.([a-zA-Z0-9_$]+)\}$/,HTML_ATTR:"data-sifrr-html",REPEAT_ATTR:"data-sifrr-repeat",KEY_ATTR:"data-sifrr-key",BIND_ATTR:"data-sifrr-bind",DEFAULT_STATE_ATTR:"data-sifrr-default-state",STATE_ATTR:"data-sifrr-state"};const{TEXT_NODE:o,TREE_WALKER:i}=r,s=i();var a={collect:function(t,e){const n=e.length,r=new Array(n);s.currentNode=t;for(let o,i=0;i<n;i++){for(o=e[i].idx;--o;)t=s.nextNode();r[i]=t}return r},create:function(t,e,n){const r=i();let s,a,l=[],c=0;for(r.currentNode=t;t;)t.nodeType===o&&""===t.data.trim()?(a=t,t=r.nextNode(),a.remove()):((s=e(t,n))?(l.push({idx:c+1,ref:s}),c=1):c++,t=r.nextNode());return l}};const{TEMPLATE:l}=r;var c=(t,...e)=>{if(t.tagName&&"TEMPLATE"===t.tagName)return t;let n=!1;const r=l();if("string"==typeof t)n=!0,"string"==typeof e[0]&&(t="<style>".concat(e.join(""),"</style>").concat(t));else if(Array.isArray(t)&&"string"==typeof t[0])n=!0,t=String.raw(t,...e);else if(t instanceof NodeList||Array.isArray(t)&&t[0].nodeType)Array.from(t).forEach(t=>{r.content.appendChild(t)});else{if(!t.nodeType)throw Error("Argument must be of type string | template literal | Node | [Node] | NodeList");r.content.appendChild(t)}return n&&(r.innerHTML=t.replace(/(\\)?\$(\\)?\{/g,"${")),r},d=(t,e,n)=>{!1===n||null==n?t.hasAttribute(e)&&t.removeAttribute(e):"class"===e?t.className=n:"id"===e||"value"===e?t[e]=n:t.getAttribute(e)!==n&&t.setAttribute(e,n)},u=(t,e)=>{if("object"!=typeof t)return t!==e;for(const n in e)if(!(n in t)||t[n]!==e[n])return!0;return!1};const{TEXT_NODE:h,COMMENT_NODE:f}=r;function g(t,e,n,r=!1){const o=e.length,i=t.childNodes.length;if(i>o){let e=i;for(;e>o;)t.removeChild(t.lastChild),e--}let s,a=t.firstChild,l=e[0];if(r){for(;a;)s=l.nextSibling,a=m(a,l).nextSibling,l=s;for(;l;)s=l.nextSibling,t.appendChild(l),l=s}else{let r=0;for(;a;)a=m(a,e[r]).nextSibling,r++;for(;r<o;)s=e[r],t.appendChild(s.nodeType?s:n(s)),r++}}function m(t,e){if(!e.nodeType)return u(t._state,e)&&(t.state=e),t;if(t.nodeName!==e.nodeName)return t.replaceWith(e),e;if(t.nodeType===h||t.nodeType===f)return t.data!==e.data&&(t.data=e.data),t;e.state&&(t.state=e.state);const n=t.attributes,r=e.attributes;for(let e=r.length-1;e>-1;--e)d(t,r[e].name,r[e].value);for(let r=n.length-1;r>-1;--r)e.hasAttribute(n[r].name)||t.removeAttribute(n[r].name);return g(t,e.childNodes,void 0,!0),t}var p={makeEqual:m,makeChildrenEqual:g};const{makeEqual:E}=p;function w(t,e){let n=[],r=[],o=-1,i=new Array(t.length);for(let s=e,a=t.length;s<a;s++){let e=t[s];if(e<0)continue;let a=_(n,e);-1!==a&&(i[s]=r[a]),a===o?(n[++o]=e,r[o]=s):e<n[a+1]&&(n[a+1]=e,r[a+1]=s)}for(let t=r[o];o>-1;t=i[t],o--)n[o]=t;return n}function _(t,e){let n=-1,r=t.length;if(r>0&&t[r-1]<=e)return r-1;for(;r-n>1;){let o=Math.floor((n+r)/2);t[o]>e?r=o:n=o}return n}var T={makeChildrenEqualKeyed:function(t,e,n,r){const o=e.length,i=t.childNodes.length;if(0===i){for(let r=0;r<o;r++)t.appendChild(n(e[r]));return}let s,a,l,c,d=0,u=0,h=!0,f=i-1,g=o-1,m=t.firstChild,p=t.lastChild;t:for(;h;){for(h=!1,a=m.state,l=e[u];a[r]===l[r];){if(E(m,l),d++,m=m.nextSibling,u++,f<d||g<u)break t;a=m.state,l=e[u]}for(a=p.state,l=e[g];a[r]===l[r];){if(E(p,l),f--,s=p,p=p.previousSibling,g--,f<d||g<u)break t;a=p.state,l=e[g]}for(a=p.state,l=e[u];a[r]===l[r];){if(h=!0,E(p,l),c=p.previousSibling,t.insertBefore(p,m),p=c,u++,--f<d||g<u)break t;a=p.state,l=e[u]}for(a=m.state,l=e[g];a[r]===l[r];){if(h=!0,E(m,l),c=m.nextSibling,t.insertBefore(m,p.nextSibling),s=m,p=m.previousSibling,m=c,g--,f<++d||g<u)break t;a=m.state,l=e[g]}}if(g<u){if(d<=f){let e;for(;d<=f;)0===f?t.removeChild(p):(e=p.previousSibling,t.removeChild(p),p=e),f--}return}if(f<d){if(u<=g)for(;u<=g;)c=n(e[u]),t.insertBefore(c,s),p=c,u++;return}const _=new Array(g+1-u),T=new Map,y=new Array(f-d+1),b=[];for(let t=u;t<=g;t++)_[t]=-1,T.set(e[t][r],t);let S=0;for(;d<=f;)T.has(m.state[r])?(_[T.get(m.state[r])]=d,S++):b.push(m),y[d]=m,m=m.nextSibling,d++;for(let e=0;e<b.length;e++)t.removeChild(b[e]);if(0===S){for(let r=u;r<=g;r++)t.insertBefore(n(e[r]),m);return}const A=w(_,u);let v,x=A.length-1;for(let r=g;r>=u;r--)A[x]===r?(s=y[_[r]],E(s,e[r]),x--):(-1===_[r]?v=n(e[r]):(v=y[_[r]],E(v,e[r])),t.insertBefore(v,s),s=v)},longestPositiveIncreasingSubsequence:w};const{OUTER_REGEX:y,STATE_REGEX:b}=r;function S(t){let e;e=t.indexOf("return ")>-1?t:"return "+t;try{return new Function(e)}catch(t){return window.console.log("Error processing binding: `".concat(e,"`")),""}}function A(t,e){try{return"string"==typeof t?t:t.call(e)}catch(n){const r=t.toString();window.console.log("Error evaluating: `".concat(r.slice(r.indexOf("{")+1,r.lastIndexOf("}")),"` for element"),e),window.console.error(n)}}const v={getBindingFxns:t=>{const e=t.split(y),n=e.length,r=[];for(let t=0;t<n;t++)"$"===e[t][0]&&"{"===e[t][1]?r.push(S(e[t].slice(2,-1))):e[t]&&r.push(e[t]);return 1===r.length?r[0]:r},getStringBindingFxn:t=>{const e=t.match(b);return e?e[1]:v.getBindingFxns(t)},evaluateBindings:(t,e)=>"function"==typeof t?A(t,e):t.map(t=>A(t,e)).join(""),evaluate:A,replacer:S};var x=v;const{makeChildrenEqual:N}=p,{makeChildrenEqualKeyed:C}=T,{evaluateBindings:R}=x,{TEMPLATE:O,KEY_ATTR:L}=r;var M=function(t,e){e=e||t.constructor.stateMap;for(let n=t._refs?t._refs.length-1:-1;n>-1;--n){const r=e[n].ref,o=t._refs[n];if(0===r.type){o.__data!=t._state[r.text]&&(o.data=o.__data=t._state[r.text]);continue}if(1===r.type){const e=R(r.text,t);o.data!=e&&(o.data=e);continue}if(r.events){if(!o._sifrrEventSet){for(let e=r.events.length-1;e>-1;--e){const n=r.events[e];o[n[0]]=R(n[1],t)}o._root=t,o._sifrrEventSet=!0}if(r.events.__sb){const e=R(r.events.__sb,t);u(e,o._state)&&(o.state=e)}}if(r.attributes)for(let e=r.attributes.length-1;e>-1;--e){const n=r.attributes[e];let i;i=0===n[1]?t._state[n[2]]:R(n[2],t),d(o,n[0],i)}if(void 0===r.text)continue;let i;if((i="string"==typeof r.text?t._state[r.text]:R(r.text,t))&&0!==i.length)if(3===r.type){let e;r.se._root=t,r.keyed&&(e=o.getAttribute(L))?C(o,i,r.se.sifrrClone.bind(r.se),e):N(o,i,r.se.sifrrClone.bind(r.se))}else{const e=R(r.text,t);let n,i=!1;if(Array.isArray(e))n=e;else if(e.content&&11===e.content.nodeType)n=e.content.childNodes,i=!0;else if(e.nodeType)n=[e];else if("string"==typeof e){const t=O();t.innerHTML=e.toString(),n=t.content.childNodes,i=!0}else n=Array.prototype.slice.call(e);N(o,n,void 0,i)}else o.textContent=""}};const{collect:k,create:$}=a;function q(t){const e=this.cloneNode(!0);return e.root=this._root,e._refs=k(e,this.stateMap),e._state=Object.assign({},this.defaultState,t),Object.defineProperty(e,"state",this.stateProps),M(e,this.stateMap),e}var D=function(t,e=null){const n=c(t);return(t=n.content.firstElementChild||n.content.firstChild).isSifrr||-1!==t.nodeName.indexOf("-")||t.getAttribute&&t.getAttribute("is")&&t.getAttribute("is").indexOf("-")>0?(t.isSifrr||(window.document.body.appendChild(t),window.document.body.removeChild(t)),t):(t.defaultState=e,t.stateMap=$(t,Y,e),t.sifrrClone=q,t.stateProps={get:function(){return this._state},set:function(e){this._state!==e&&Object.assign(this._state,e),M(this,t.stateMap)}},t)};const{getStringBindingFxn:P}=x,{KEY_ATTR:B,REPEAT_ATTR:U,DEFAULT_STATE_ATTR:j}=r;var F=(t,e)=>{let n;t.type=3,e.hasAttribute(j)&&(n=JSON.parse(e.getAttribute(j))),t.se=D(e.childNodes,n),t.text=P(e.getAttribute(U)),t.keyed=e.hasAttribute(B),e.removeAttribute(U)};const{TEXT_NODE:H,COMMENT_NODE:K,ELEMENT_NODE:W,HTML_ATTR:I,REPEAT_ATTR:X}=r,{getBindingFxns:J,getStringBindingFxn:G}=x;var Y=function(t,e){if(t.nodeType===H||t.nodeType===K){const n=t.data;if(n.indexOf("${")>-1){const r=G(n.trim());return"string"!=typeof r?{type:1,text:r}:(e&&(t.data=t.__data=e[r]),{type:0,text:r})}}else if(t.nodeType===W){const n={};if(t.hasAttribute(I)){const e=t.innerHTML;e.indexOf("${")>-1&&(n.type=2,n.text=J(e.replace(/<!--((?:(?!-->).)+)-->/g,"$1").trim())),t.textContent=""}else t.hasAttribute(X)&&F(n,t);const r=t.attributes,o=r.length,i=[],s=[];for(let n=0;n<o;n++){const o=r[n];if("_"===o.name[0]&&o.value.indexOf("${")>-1)"_state"===o.name?s.__sb=J(o.value):s.push([o.name,J(o.value)]);else if(o.value.indexOf("${")>-1){const n=G(o.value);"string"!=typeof n?i.push([o.name,1,n]):(i.push([o.name,0,n]),e&&d(t,o.name,e[n]))}}if((s.length>0||s.__sb)&&(n.events=s),i.length>0&&(n.attributes=i),Object.keys(n).length>0)return n}return 0};class z{constructor(t,e){if(!window.fetch)throw Error("Sifrr.Dom.load requires Fetch API to work.");if(this.constructor.all[t])return this.constructor.all[t];this.elementName=t,z.all[this.elementName]=this,this.url=e}executeScripts(t=!0){return this._exec?this._exec:t?(this._exec=this.constructor.executeJS(this.getUrl("js")).catch(t=>(window.console.error(t),window.console.log("JS file for '".concat(this.elementName,"' gave error. Trying to get html file.")),this.constructor.executeHTML(this.getUrl("html"),this))),this._exec):(this._exec=this.constructor.executeHTML(this.getUrl("html"),this),this._exec)}getUrl(t="js"){return this.url||"".concat(window.Sifrr.Dom.config.baseUrl+"/","elements/").concat(this.elementName.split("-").join("/"),".").concat(t)}static getFile(t){return window.fetch(t).then(t=>{if(t.ok)return t.text();throw Error("".concat(this.getUrl("html")," - ").concat(t.status," ").concat(t.statusText))})}static executeHTML(t,e){return this.getFile(t).then(t=>c(t).content).then(n=>{let r=Promise.resolve(!0);return e.template=n.querySelector("template"),n.querySelectorAll("script").forEach(e=>{e.src?(window.fetch(e.src),r=r.then(()=>window.fetch(e.src).then(t=>t.text())).then(t=>new Function(t+"\n//# sourceURL=".concat(e.src)).call(window))):r=r.then(()=>new Function(e.text+"\n//# sourceURL=".concat(t)).call(window))}),r})}static executeJS(t){return this.getFile(t).then(e=>new Function(e+"\n //# sourceURL=".concat(t)).call())}}z.all={};var Z=z;const Q={},V={capture:!0,passive:!0},tt=t=>e=>{const n=e.composedPath?e.composedPath()[0]:e.target;let r=n;for(;r;){const o=r["_".concat(t)]||(r.hasAttribute?r.getAttribute("_".concat(t)):null);"function"==typeof o?o.call(r._root||window,e,n):"string"==typeof o&&new Function("event","target",o).call(r._root||window,event,n),et(e,t,r,n),r=r.parentNode||r.host}},et=(t,e,n,r)=>{function o(e,o){e.forEach(e=>{o&&e.__dom!==n||e(t,r,n)})}for(let t in Q[e])("function"==typeof n.matches&&n.matches(t)||9===n.nodeType&&"document"===t||"element"===t)&&o(Q[e][t],"element"===t)};var nt={all:Q,add:t=>{if(Q[t])return!1;const e=tt(t);return window.addEventListener(t,e,V),Q[t]={},!0},addListener:(t,e,n)=>{if(!Q[t])throw Error("You need to call Sifrr.Dom.Event.add('".concat(t,"') before using listeners."));return"string"!=typeof e&&(n.__dom=e,e="element"),Q[t][e]=Q[t][e]||new Set,Q[t][e].add(n),!0},removeListener:(t,e,n)=>(Q[t][e]&&Q[t][e].delete(n),!0),trigger:(t,e,n)=>{"string"==typeof t&&(t=document.$(t));const r=new CustomEvent(e,Object.assign({bubbles:!0,composed:!0},n));t.dispatchEvent(r)},opts:V,getEventListener:tt};const{collect:rt,create:ot}=a,{trigger:it}=nt,{BIND_ATTR:st,STATE_ATTR:at}=r;var lt=function t(e){return class extends e{static extends(e){return t(e)}static get observedAttributes(){return[at].concat(this.observedAttrs()).concat(this.syncedAttrs())}static syncedAttrs(){return[]}static observedAttrs(){return[]}static get template(){return(Z.all[this.elementName]||{template:!1}).template}static get ctemp(){return this._ctemp?this._ctemp:(this.template&&(this._ctemp=c(this.template),this.useShadowRoot&&window.ShadyCSS&&!window.ShadyCSS.nativeShadow&&window.ShadyCSS.prepareTemplate(this._ctemp,this.elementName),this.stateMap=ot(this._ctemp.content,Y,this.defaultState)),this._ctemp||!1)}static get elementName(){return this.name.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}static get useShadowRoot(){return this.useSR}constructor(){super();let t=this.stores;if(t)for(let e in t)t[e].addListener(this.update.bind(this));if(this.constructor.ctemp){this._state=Object.assign({},this.constructor.defaultState,this.state);const t=this.constructor.ctemp.content.cloneNode(!0);this._refs=rt(t,this.constructor.stateMap),this.constructor.useShadowRoot?(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(t)):this.__content=t}}connectedCallback(){this.connected=!0,this.__content&&(0!==this.childNodes.length&&(this.textContent=""),this.appendChild(this.__content),delete this.__content),this.hasAttribute(at)||this.update(),this.onConnect()}onConnect(){}disconnectedCallback(){this.onDisconnect()}onDisconnect(){}attributeChangedCallback(t,e,n){t===at&&(this.state=JSON.parse(n)),this.constructor.syncedAttrs().indexOf(t)>-1&&(this[t]=n),this.onAttributeChange(t,e,n)}onAttributeChange(){}get state(){return this._state}set state(t){this._state&&(this._state!==t&&Object.assign(this._state,t),this.update(),this.onStateChange())}onStateChange(){}update(){this.beforeUpdate(),M(this),(this._update||this.triggerUpdate||this.hasAttribute(st))&&it(this,"update",{detail:{state:this.state}}),this.onUpdate()}beforeUpdate(){}onUpdate(){}isSifrr(t=null){return!t||t===this.constructor.elementName}sifrrClone(t){const e=this.cloneNode(!1);return e._state=t,e}clearState(){this._state={},this.update()}$(t,e=!0){return this.shadowRoot&&e?this.shadowRoot.querySelector(t):this.querySelector(t)}$$(t,e=!0){return this.shadowRoot&&e?this.shadowRoot.querySelectorAll(t):this.querySelectorAll(t)}get root(){if(void 0===this._root){let t=this.parentNode;for(;t&&!t.isSifrr;)t=t.parentNode||t.host;this._root=t||null}return this._root}}}(window.HTMLElement);const{BIND_ATTR:ct}=r;const dt={}.constructor;var ut=class{constructor(t){this.value=t,this.listeners=[]}set(t){u(this.value,t)&&(this.value.constructor===dt?Object.assign(this.value,t):this.value=t),this.listeners.forEach(t=>t())}addListener(t){this.listeners.push(t)}};const{BIND_ATTR:ht}=r,ft="["+ht+"]";let gt={elements:{},loadingElements:{},registering:[]};return gt.Element=lt,gt.twoWayBind=t=>{const e=t.composedPath?t.composedPath()[0]:t.target;if(!e.hasAttribute(ct)||null===e._root)return;if("update"===t.type&&!e._sifrrEventSet)return;const n=e.value||e._state||e.textContent;if(e.firstChild&&(e.firstChild.__data=n),!e._root){let t=e.parentNode;for(;t&&!t.isSifrr;)t=t.parentNode||t.host;e._root=t||null}const r=e.getAttribute(ct);e._root&&u(n,e._root._state[r])&&("update"===t.type?e._root.state={[r]:Object.assign({},n)}:e._root.state={[r]:n})},gt.Loader=Z,gt.SimpleElement=D,gt.Event=nt,gt.makeChildrenEqual=p.makeChildrenEqual,gt.makeChildrenEqualKeyed=T.makeChildrenEqualKeyed,gt.makeEqual=p.makeEqual,gt.Store=ut,gt.template=c,gt.register=(e,n={})=>{e.useSR=gt.config.useShadowRoot;const r=n.name||e.elementName;if(!r)throw Error("Error creating Custom Element: No name given.",e);if(!window.customElements.get(r)){if(r.indexOf("-")<1)throw Error("Error creating Element: ".concat(r," - Custom Element name must have one dash '-'"));{let t;t=Array.isArray(n.dependsOn)?Promise.all(n.dependsOn.map(t=>gt.load(t))):"string"==typeof n.dependsOn?gt.load(n.dependsOn):Promise.resolve(!0),delete n.dependsOn;const o=t.then(()=>window.customElements.define(r,e,n));return gt.registering[r]=o,o.then(()=>{gt.elements[r]=e,delete gt.registering[r]}).catch(t=>{throw Error("Error creating Custom Element: ".concat(r," - ").concat(t.message))})}}t.console.warn("Error creating Element: ".concat(r," - Custom Element with this name is already defined."))},gt.setup=function(t){if(HTMLElement.prototype.$=HTMLElement.prototype.querySelector,HTMLElement.prototype.$$=HTMLElement.prototype.querySelectorAll,document.$=document.querySelector,document.$$=document.querySelectorAll,gt.config=Object.assign({baseUrl:"",useShadowRoot:!0,events:[]},t),"string"!=typeof gt.config.baseUrl)throw Error("baseUrl should be a string");gt.config.events.push("input","change","update"),gt.config.events.forEach(t=>gt.Event.add(t)),gt.Event.addListener("input",ft,gt.twoWayBind),gt.Event.addListener("change",ft,gt.twoWayBind),gt.Event.addListener("update",ft,gt.twoWayBind),window.Sifrr=window.Sifrr||{},window.Sifrr.Dom=window.Sifrr.Dom||gt},gt.load=function(t,{url:e,js:n=!0}={}){if(window.customElements.get(t))return Promise.resolve(window.console.warn("Error loading Element: ".concat(t," - Custom Element with this name is already defined.")));return gt.loadingElements[t]=window.customElements.whenDefined(t),new gt.Loader(t,e).executeScripts(n).then(()=>gt.registering[t]).then(()=>{window.customElements.get(t)||window.console.warn("Executing '".concat(t,"' file didn't register the element.")),delete gt.registering[t],delete gt.loadingElements[t]}).catch(e=>{throw delete gt.registering[t],delete gt.loadingElements[t],e})},gt.loading=()=>{const t=[];for(let e in gt.loadingElements)t.push(gt.loadingElements[e]);return Promise.all(t)},gt});
/*! (c) @aadityataparia */
