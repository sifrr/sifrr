/*! Sifrr.Dom v0.0.3 - sifrr project | MIT licensed | https://github.com/sifrr/sifrr */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@sifrr/fetch")):"function"==typeof define&&define.amd?define(["@sifrr/fetch"],e):((t=t||self).Sifrr=t.Sifrr||{},t.Sifrr.Dom=e(t.Sifrr.Fetch))}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;const e=window.document.createElement("template"),n=window.document.createElement("script");var r={TEMPLATE:()=>e.cloneNode(!1),SCRIPT:()=>n.cloneNode(!1),TEXT_NODE:3,COMMENT_NODE:8,ELEMENT_NODE:1,OUTER_REGEX:new RegExp("(\\${(?:(?:[^{}$]|{(?:[^{}$])*})*)})","g"),STATE_REGEX:/^\$\{this\.state\.([a-zA-Z0-9_$]+)\}$/,HTML_ATTR:"data-sifrr-html",REPEAT_ATTR:"data-sifrr-repeat",KEY_ATTR:"data-sifrr-key"};const i=window.document.createTreeWalker(window.document,window.NodeFilter.SHOW_ALL,null,!1),{HTML_ATTR:o}=r;function s(t){return t.hasAttribute&&t.hasAttribute(o)}i.nextFilteredNode=function(){let t=this.currentNode;return t=s(t)?this.nextSibling()||(this.parentNode(),this.nextSibling()):this.nextNode()},i.roll=function(t,e="nextFilteredNode"){let n=this.currentNode;for(;--t;)n=this[e]();return n};var a={collect:function(t,e,n){const r=[],o=e.length;i.currentNode=t;for(let t=0;t<o;t++)r.push(i.roll(e[t].idx,n));return r},create:function(t,e,n){let r,o=[],a=0;for(i.currentNode=t;t;)(r=e(t,s,n))?(o.push({idx:a+1,ref:r}),a=1):a++,t=i.nextFilteredNode(t);return o}};const{TEMPLATE:l}=r;var c=(t,...e)=>{const n=l();if("string"==typeof t);else{if(!t[0]||"string"!=typeof t[0])return t[0]?(Array.from(t).forEach(t=>{n.content.appendChild(t)}),n):t.nodeType&&!t.content?(n.content.appendChild(t),n):t;t=String.raw(t,...e)}return t=t.replace(/>\n+/g,">").replace(/\s+</g,"<").replace(/>\s+/g,">").replace(/(\\)?\$(\\)?\{/g,"${"),n.innerHTML=t,n},d=(t,e,n)=>{if(!1===n||null==n)t.hasAttribute(e)&&t.removeAttribute(e);else{t.getAttribute(e)!==n&&("class"===e?t.className=n:t.setAttribute(e,n))}"value"!=e||"SELECT"!=t.nodeName&&"INPUT"!=t.nodeName||(t.value=n)};var u={shallowEqual:(t,e)=>{for(let n in t)if(!(n in e)||t[n]!==e[n])return!1;for(let n in e)if(!(n in t)||t[n]!==e[n])return!1;return!0}};const{shallowEqual:h}=u,{TEXT_NODE:f,COMMENT_NODE:m}=r;function p(t,e,n,r=!1){const i=e.length;if(0===i)return void(t.textContent="");const o=t.childNodes.length;if(o>i){let e=o;for(;e>i;)t.removeChild(t.lastChild),e--}let s,a=t.firstChild,l=e[0];if(r){for(;a;)s=l.nextSibling,a=g(a,l).nextSibling,l=s;for(;l;)s=l.nextSibling,t.appendChild(l),l=s}else{let r=0;for(;a;)a=g(a,e[r]).nextSibling,r++;for(;r<i;)(s=e[r]).nodeType||(s=n(s)),t.appendChild(s),r++}}function g(t,e){if(!e.nodeType)return h(t.state,e)||(t.state=e),t;if(t.nodeName!==e.nodeName)return t.replaceWith(e),e;if(t.nodeType===f||t.nodeType===m)return t.data!==e.data&&(t.data=e.data),t;e.state&&(t.state=e.state);const n=t.attributes,r=e.attributes;for(let e=r.length-1;e>=0;--e)d(t,r[e].name,r[e].value);for(let r=n.length-1;r>=0;--r)e.hasAttribute(n[r].name)||t.removeAttribute(n[r].name);return p(t,Array.prototype.slice.call(e.childNodes)),t}var E={makeEqual:g,makeChildrenEqual:p};const{makeEqual:w}=E;function y(t,e){let n=[],r=[],i=-1,o=new Array(t.length);for(let s=e,a=t.length;s<a;s++){let e=t[s];if(e<0)continue;let a=b(n,e);-1!==a&&(o[s]=r[a]),a===i?(n[++i]=e,r[i]=s):e<n[a+1]&&(n[a+1]=e,r[a+1]=s)}for(let t=r[i];i>=0;t=o[t],i--)n[i]=t;return n}function b(t,e){let n=-1,r=t.length;if(r>0&&t[r-1]<=e)return r-1;for(;r-n>1;){let i=Math.floor((n+r)/2);t[i]>e?r=i:n=i}return n}var S={makeChildrenEqualKeyed:function(t,e,n,r){const i=e.length;if(0===i)return void(t.textContent="");const o=t.childNodes.length;if(0===o){for(let r=0;r<i;r++)t.appendChild(n(e[r]));return}let s,a,l,c,d=0,u=0,h=!0,f=o-1,m=i-1,p=t.firstChild,g=t.lastChild;t:for(;h;){for(h=!1,a=p.state,l=e[u];a[r]===l[r];){if(w(p,l),d++,p=p.nextSibling,u++,f<d||m<u)break t;a=p.state,l=e[u]}for(a=g.state,l=e[m];a[r]===l[r];){if(w(g,l),f--,s=g,g=g.previousSibling,m--,f<d||m<u)break t;a=g.state,l=e[m]}for(a=g.state,l=e[u];a[r]===l[r];){if(h=!0,w(g,l),c=g.previousSibling,t.insertBefore(g,p),g=c,u++,--f<d||m<u)break t;a=g.state,l=e[u]}for(a=p.state,l=e[m];a[r]===l[r];){if(h=!0,w(p,l),c=p.nextSibling,t.insertBefore(p,g.nextSibling),s=p,g=p.previousSibling,p=c,m--,f<++d||m<u)break t;a=p.state,l=e[m]}}if(m<u){if(d<=f){let e;for(;d<=f;)0===f?t.removeChild(g):(e=g.previousSibling,t.removeChild(g),g=e),f--}return}if(f<d){if(u<=m)for(;u<=m;)c=n(e[u]),t.insertBefore(c,g.nextSibling),g=c,u++;return}const E=new Array(m+1-u),b=new Map,S=[],v=[];for(let t=u;t<=m;t++)E[t]=-1,b.set(e[t][r],t);let _=0;for(;d<=f;)b.has(p.state[r])?(E[b.get(p.state[r])]=d,_++):v.push(p),S[d]=p,p=p.nextSibling,d++;if(0===_){for(let r=u;r<=m;r++)t.insertBefore(n(e[r]),p);for(let e=0;e<v.length;e++)t.removeChild(v[e]);return}const T=y(E,u);let x,C=T.length-1;for(let r=m;r>=u;r--)T[C]===r?(s=S[E[r]],w(s,e[r]),C--):(-1===E[r]?x=n(e[r]):(x=S[E[r]],w(x,e[r])),t.insertBefore(x,s),s=x);for(let e=0;e<v.length;e++)t.removeChild(v[e])},longestPositiveIncreasingSubsequence:y};const{OUTER_REGEX:v,STATE_REGEX:_}=r;function T(t){let e;e=t.indexOf("return ")>=0?t:"return "+t;try{return new Function(e)}catch(t){return window.console.log(`Error processing binding: \`${e}\``),""}}function x(t,e){try{return"string"==typeof t?t:t.call(e)}catch(n){const r=t.toString();window.console.log(`Error evaluating: \`${r.slice(r.indexOf("{")+1,r.lastIndexOf("}"))}\` for element`,e),window.console.error(n)}}const C={getBindingFxns:t=>{const e=t.split(v),n=e.length,r=[];for(let t=0;t<n;t++)"$"===e[t][0]&&"{"===e[t][1]?r.push(T(e[t].slice(2,-1))):e[t]&&r.push(e[t]);return 1===r.length?r[0]:r},getStringBindingFxn:t=>{const e=t.match(_);return e?e[1]:C.getBindingFxns(t)},evaluateBindings:(t,e)=>"function"==typeof t?x(t,e):t.map(t=>x(t,e)).join(""),evaluate:x,replacer:T};var N=C;const{makeChildrenEqual:A}=E,{makeChildrenEqualKeyed:O}=S,{evaluateBindings:$}=N,{TEMPLATE:M,KEY_ATTR:R}=r;var L=function(t,e){if(!t._refs)return!1;let n,r,i;e=e||t.constructor.stateMap;const o=t._refs.length;for(let s=0;s<o;s++)if(n=e[s].ref,r=t._refs[s],0!==n.type)if(1!==n.type){if(n.attributes)for(let e in n.attributes)if("events"!==e)i=0===n.attributes[e].type?t.state[n.attributes[e].text]:$(n.attributes[e].text,t),d(r,e,i);else if(!r._sifrrEventSet){for(let e in n.attributes.events)r[e]=$(n.attributes.events[e],t);r._root=t,r._sifrrEventSet=!0}if(void 0!==n.text)if(i=$(n.text,t),3===n.type){let t;n.keyed&&(t=r.getAttribute(R))?O(r,i,t=>n.se.sifrrClone(void 0,t),t):A(r,i,t=>n.se.sifrrClone(void 0,t))}else{let t,e=!1;if(Array.isArray(i))t=i;else if(i.content&&11===i.content.nodeType)t=i.content.childNodes,e=!0;else if(i.nodeType)t=[i];else if("string"==typeof i){const n=M();n.innerHTML=i.toString(),t=n.content.childNodes,e=!0}else t=Array.prototype.slice.call(i);A(r,t,void 0,e)}}else i=$(n.text,t),r.data!=i&&(r.data=i);else i=t.state[n.text],r.data!=i&&(r.data=i)};const{collect:j,create:P}=a;var k=function(t,e=null){if(!(t.nodeType||"string"==typeof t||t[0]&&t[0].nodeType))throw TypeError("First argument for SimpleElement should be of type string or DOM element");const n=c(t);if((t=n.content.firstElementChild||n.content.firstChild).isSifrr||-1!==t.nodeName.indexOf("-")||t.getAttribute&&t.getAttribute("is")&&-1!==t.getAttribute("is").indexOf("-"))return t.isSifrr||(window.document.body.appendChild(t),window.document.body.removeChild(t)),t;const r=P(t,K,e),i={get:function(){return this._state},set:function(t){Object.assign(this._state,t),L(this,r)}};return t.sifrrClone=function(n=!0,o){const s=t.cloneNode(n);return s._refs=j(s,r,"nextNode"),s._state=Object.assign({},e,o),Object.defineProperty(s,"state",i),L(s,r),s},t};const{getBindingFxns:q}=N,{KEY_ATTR:U}=r;var F=(t,e,n)=>{let r;t.type=3,e.hasAttribute("data-sifrr-default-state")&&(r=JSON.parse(e.getAttribute("data-sifrr-default-state"))),t.se=k(e.childNodes,r),t.text=q(e.getAttribute(n)),t.keyed=e.hasAttribute(U),e.textContent="",e.removeAttribute(n)};const{TEXT_NODE:B,COMMENT_NODE:D,ELEMENT_NODE:H,REPEAT_ATTR:X}=r,{getBindingFxns:I,getStringBindingFxn:W}=N;var K=function(t,e,n){if(t.nodeType===B||t.nodeType===D){const e=t.data;if(e.indexOf("${")>-1){const r=W(e.trim());return"string"!=typeof r?{type:1,text:r}:(n&&(t.data=n[r]),{type:0,text:r})}}else if(t.nodeType===H){const r={};if(e(t)){const e=t.innerHTML;e.indexOf("${")>=0&&(r.type=2,r.text=I(e.replace(/<!--((?:(?!-->).)+)-->/g,"$1").trim()))}else t.hasAttribute(X)&&F(r,t,X);const i=t.attributes,o=i.length,s={events:{}};for(let e=0;e<o;e++){const r=i[e];if("_"===r.name[0])s.events[r.name]=I(r.value);else if(r.value.indexOf("${")>=0){const e=W(r.value);"string"!=typeof e?s[r.name]={type:1,text:e}:(s[r.name]={type:0,text:e},n&&d(t,r.name,n[e]))}}if(0===Object.keys(s.events).length&&delete s.events,Object.keys(s).length>0&&(r.attributes=s),Object.keys(r).length>0)return r}return 0};class G{constructor(e,n,r){if(!t)throw Error("Sifrr.Dom.load requires Sifrr.Fetch to work.");if(this.constructor.all[e])return this.constructor.all[e];this.elementName=e,this.url=n,this.onProgress=r}get html(){if(this._html)return this._html;G.add(this.elementName,this);const e=this;return this._html=t.file(this.htmlUrl,{onProgress:this.onProgress}).then(t=>t.text()).then(t=>c(t).content).then(t=>(e.template=t.querySelector("template"),t)),this._html}get js(){return this._js?this._js:(G.add(this.elementName,this),this._js=t.file(this.jsUrl,{onProgress:this.onProgress}).then(t=>t.text()),this._js)}get htmlUrl(){return this.url||`${window.Sifrr.Dom.config.baseUrl+"/"}elements/${this.elementName.split("-").join("/")}.html`}get jsUrl(){return this.url||`${window.Sifrr.Dom.config.baseUrl+"/"}elements/${this.elementName.split("-").join("/")}.js`}executeScripts(t){if(this._executed)throw Error(`'${this.elementName}' element's javascript was already executed`);return this._executed=!0,t?this.js.then(t=>{new Function(t+`\n //# sourceURL=${this.jsUrl}`).call()}).catch(t=>(window.console.error(t),window.console.log(`JS file for '${this.elementName}' gave error. Trying to get html file.`),this.executeHTMLScripts())):this.executeHTMLScripts()}executeHTMLScripts(){return this.html.then(t=>{t.querySelectorAll("script").forEach(e=>{if(e.src){const t=r.SCRIPT();t.src=e.src,t.type=e.type,window.document.body.appendChild(t)}else new Function(e.text+`\n //# sourceURL=${this.htmlUrl}`).call({currentTempate:t.querySelector("template")})})}).catch(t=>{throw t})}static add(t,e){G._all[t]=e}static get all(){return G._all}}G._all={};var J=G;const{collect:Y,create:z}=a;var Z=function t(e){return class extends e{static extends(e){return t(e)}static get observedAttributes(){return["data-sifrr-state"].concat(this.observedAttrs())}static observedAttrs(){return[]}static get template(){return(J.all[this.elementName]||{template:!1}).template}static get ctemp(){return this._ctemp?this._ctemp:(this._ctemp=this.template,this.useShadowRoot&&window.ShadyCSS&&!window.ShadyCSS.nativeShadow&&window.ShadyCSS.prepareTemplate(this._ctemp,this.elementName),this._ctemp)}static get stateMap(){return this._stateMap=this._stateMap||z(this.ctemp.content,K),this._stateMap}static get elementName(){return this.name.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}static get useShadowRoot(){return this.useSR}constructor(){if(super(),this.constructor.ctemp){this._state=Object.assign({},this.constructor.defaultState,this.state);const t=this.constructor.ctemp.content.cloneNode(!0);this._refs=Y(t,this.constructor.stateMap),this.constructor.useShadowRoot?(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(t)):this.__content=t}}connectedCallback(){this.__content&&(this.textContent="",this.appendChild(this.__content),delete this.__content),this.hasAttribute("data-sifrr-state")||this.update(),this.onConnect()}onConnect(){}disconnectedCallback(){this.onDisconnect()}onDisconnect(){}attributeChangedCallback(t,e,n){"data-sifrr-state"===t&&(this.state=JSON.parse(n)),this.onAttributeChange(t,e,n)}onAttributeChange(){}get state(){return this._state}set state(t){this._state!==t&&Object.assign(this._state,t),this.update(),this.onStateChange()}onStateChange(){}update(){L(this),this.onUpdate()}onUpdate(){}isSifrr(t=null){return!t||t===this.constructor.elementName}sifrrClone(t=!1,e){const n=this.cloneNode(t);return n._state=Object.assign({},this.constructor.defaultState,e),n}clearState(){this._state={},this.update()}$(t,e=!0){return this.constructor.useShadowRoot&&e?this.shadowRoot.querySelector(t):this.querySelector(t)}$$(t,e=!0){return this.constructor.useShadowRoot&&e?this.shadowRoot.querySelectorAll(t):this.querySelectorAll(t)}}}(window.HTMLElement);const Q={},V={capture:!0,passive:!0},tt=(t,e)=>{const n=t.composedPath?t.composedPath()[0]:t.target;let r=n;for(;r;){const i=r[`_${e}`]||(r.hasAttribute?r.getAttribute(`_${e}`):null);"function"==typeof i?i.call(r._root||window,t,n):"string"==typeof i&&new Function("event","target",i).call(r._root||window,event,n),et(t,e,r,n),r=r.parentNode||r.host}},et=(t,e,n,r)=>{function i(e){e.forEach(e=>e(t,r,n))}Promise.resolve((()=>{for(let t in Q[e])("function"==typeof n.matches&&n.matches(t)||9===n.nodeType&&"document"===t)&&i(Q[e][t])})())};var nt={all:Q,add:t=>!Q[t]&&(window.addEventListener(t,e=>tt(e,t),V),Q[t]={},!0),addListener:(t,e,n)=>{const r=Q[t][e]||[];return r.indexOf(n)<0&&r.push(n),Q[t][e]=r,!0},removeListener:(t,e,n)=>{const r=Q[t][e]||[],i=r.indexOf(n);return i>=0&&r.splice(i,1),Q[t][e]=r,!0},trigger:(t,e,n)=>{"string"==typeof t&&(t=document.querySelector(t)),t.dispatchEvent(new window.Event(e,Object.assign({bubbles:!0,composed:!0},n)))},opts:V,nativeToSyntheticEvent:tt};let rt={elements:{},loadingElements:[]};return rt.Element=Z,rt.twoWayBind=(t=>{const e=t.composedPath?t.composedPath()[0]:t.target;if(!e.hasAttribute("data-sifrr-bind")||null===e._root)return;const n=e.value||e.textContent;let r={};if(!e._root){let t;for(t=e;t&&!t.isSifrr;)t=t.parentNode||t.host;e._root=t||null}r[e.getAttribute("data-sifrr-bind")]=n,e._root&&(e._root.state=r)}),rt.Loader=J,rt.SimpleElement=k,rt.Event=nt,rt.template=c,rt.register=((t,e)=>{t.useSR=rt.config.useShadowRoot;const n=t.elementName;if(!n)throw Error("Error creating Custom Element: No name given.",t);if(window.customElements.get(n))throw Error(`Error creating Element: ${n} - Custom Element with this name is already defined.`);if(n.indexOf("-")<1)throw Error(`Error creating Element: ${n} - Custom Element name must have one dash '-'`);try{return window.customElements.define(n,t,e),rt.elements[n]=t,!0}catch(t){return window.console.error(`Error creating Custom Element: ${n} - ${t.message}`,t.trace),!1}}),rt.setup=function(t){if(HTMLElement.prototype.$=HTMLElement.prototype.querySelector,HTMLElement.prototype.$$=HTMLElement.prototype.querySelectorAll,rt.config=Object.assign({baseUrl:"",useShadowRoot:!0},t),"string"!=typeof rt.config.baseUrl)throw Error("baseUrl should be a string");rt.Event.add("input"),rt.Event.add("change"),rt.Event.addListener("input","document",rt.twoWayBind),rt.Event.addListener("change","document",rt.twoWayBind)},rt.load=function(t,{url:e,js:n=!0,onProgress:r}={}){if(window.customElements.get(t))return Promise.resolve(window.console.warn(`Error loading Element: ${t} - Custom Element with this name is already defined.`));let i=new rt.Loader(t,e,r);const o=customElements.whenDefined(t);return rt.loadingElements.push(o),i.executeScripts(n).then(()=>{window.customElements.get(t)||window.console.warn(`Executing '${t}' file didn't register the element. Ignore if you are registering element in a promise or async function.`)}).catch(t=>{throw rt.loadingElements.splice(rt.loadingElements.indexOf(o),1),t})},rt.loading=(()=>Promise.all(rt.loadingElements)),rt});
/*! (c) @aadityataparia */
//# sourceMappingURL=sifrr.dom.min.js.map
