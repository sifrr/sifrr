{"version":3,"file":"sifrr.seo.module.js","sources":["../src/pagerequest.js","../src/renderer.js","../src/getcache.js","../src/constants.js","../src/middleware.js","../src/sifrr.seo.js"],"sourcesContent":["const whiteTypes = ['document', 'script', 'xhr', 'fetch'];\n\nfunction isTypeOf(request, types) {\n  const resType = request.resourceType();\n  return types.indexOf(resType) !== -1;\n}\n\nclass PageRequest {\n  constructor(npage, filter = () => true) {\n    this.npage = npage;\n    this.filter = filter;\n    this.pendingRequests = 0;\n    this.pendingPromise = new Promise(res => this.pendingResolver = res);\n    this.addOnRequestListener();\n    this.addEndRequestListener();\n  }\n\n  addOnRequestListener() {\n    const me = this;\n    this.addListener = this.npage.setRequestInterception(true).then(() => {\n      me.npage.on('request', (request) => {\n        if (isTypeOf(request, whiteTypes) && this.filter(request.url())) {\n          me.pendingRequests++;\n          request.__allowed = true;\n          request.continue();\n        } else {\n          request.__allowed = false;\n          request.abort();\n        }\n      });\n    });\n  }\n\n  addEndRequestListener() {\n    // resolve pending fetch/xhrs\n    const me = this;\n    this.npage.on('requestfailed', request => {\n      me.onEnd(request);\n    });\n    this.npage.on('requestfinished', request => {\n      me.onEnd(request);\n    });\n  }\n\n  onEnd(request) {\n    if (request.__allowed) {\n      this.pendingRequests--;\n      if (this.pendingRequests === 0) this.pendingResolver();\n    }\n  }\n\n  all() {\n    if (this.pendingRequests === 0) return Promise.resolve(true);\n    return this.pendingPromise;\n  }\n}\n\nmodule.exports = PageRequest;\n","const puppeteer = require('puppeteer');\nconst PageRequest = require('./pagerequest');\n// status\n// 0: closed\n// 1: launching\n// 2: launched\n\nclass Renderer {\n  constructor(puppeteerOptions = {}, options = {}) {\n    this.status = 0;\n    this.puppeteerOptions = Object.assign({\n      headless: true,\n      args: [],\n    }, puppeteerOptions);\n    this.puppeteerOptions.args.push(\n      '--no-sandbox',\n      '--disable-setuid-sandbox'\n    );\n    this.options = options;\n  }\n\n  async browserAsync() {\n    if (!this._browser) {\n      this._browser = puppeteer.launch(this.puppeteerOptions).then(b => {\n        b.on('disconnected', () => {\n          /* istanbul ignore next */\n          this._browser = null;\n        });\n        return b;\n      });\n    }\n    return this._browser;\n  }\n\n  close() {\n    if (this._browser) return this.browserAsync().then(b => b.close());\n    else return Promise.resolve(true);\n  }\n\n  render(url, headers = {}) {\n    const me = this;\n\n    return this.browserAsync().then((b) => b.newPage()).then(async (newp) => {\n      const fetches = new PageRequest(newp, me.options.filterOutgoingRequests);\n      await fetches.addListener;\n\n      delete headers['user-agent'];\n      await newp.setExtraHTTPHeaders(headers);\n      if (me.options.beforeRender) await newp.evaluateOnNewDocument(me.options.beforeRender);\n      const resp = await newp.goto(url, { waitUntil: 'load' });\n      const sRC = me.isHTML(resp);\n      let ret;\n\n      if (sRC) {\n        await fetches.all();\n        /* istanbul ignore next */\n        if (me.options.afterRender) await newp.evaluate(me.options.afterRender);\n        /* istanbul ignore next */\n        ret = await newp.content();\n      } else ret = false;\n\n      await newp.close();\n      return ret;\n    });\n  }\n\n  isHTML(puppeteerResp) {\n    return (puppeteerResp.headers()['content-type'] && puppeteerResp.headers()['content-type'].indexOf('html') >= 0);\n  }\n}\n\nmodule.exports = Renderer;\n","const Cache = require('cache-manager');\n\nmodule.exports = (ops) => {\n  ops = Object.assign({\n    cacheStore: 'memory',\n    maxCacheSize: 100, // in MB\n    ttl: 0 // in Seconds\n  }, ops);\n\n  return Cache.caching({\n    store: ops.cacheStore,\n    ttl: ops.ttl,\n    length: (val, key) => {\n      return Buffer.from(key + key + val).length + 2;\n    },\n    max: ops.maxCacheSize * 1000000\n  });\n};","module.exports = {\n  noop: () => {},\n  headerName: 'X-SSR-Powered-By',\n  headerValue: '@sifrr/seo'\n};\n","const { headerName, headerValue } = require('./constants');\n\n// this = sifrr seo instance\nmodule.exports = (getUrl) => {\n  return function(req, res, next) {\n    // Don't render other requests than GET\n    if (req.method !== 'GET') return next();\n\n    const url = getUrl(req);\n    const headers = req.headers;\n\n    if (this.getShouldRenderCache(url, headers) === null) {\n      res._end = res.end;\n      res.end = (resp, encoding) => {\n        if (res.hasHeader('content-type')) {\n          const contentType = res.getHeader('content-type');\n          if (contentType.indexOf('html') >= 0) {\n            this.setShouldRenderCache(url, headers, true);\n          } else {\n            this.setShouldRenderCache(url, headers, false);\n          }\n        }\n        res._end(resp, encoding);\n      };\n    }\n\n    return this.render(url, headers).then((html) => {\n      if (html) {\n        res.set(headerName, headerValue);\n        res.send(html);\n      } else {\n        next();\n      }\n    }).catch((e) => {\n      if (e.message === 'No Render') {\n        next();\n      } else next(e);\n    });\n  };\n};\n","const Renderer = require('./renderer');\nconst isHeadless = new RegExp('(headless|Headless)');\nconst getCache = require('./getcache');\n\nclass SifrrSeo {\n  constructor(userAgents = [\n    'Googlebot', // Google\n    'Bingbot', // Bing\n    'Slurp', // Slurp\n    'DuckDuckBot', // DuckDuckGo\n    'Baiduspider', //Baidu\n    'YandexBot', // Yandex\n    'Sogou', // Sogou\n    'Exabot', // Exalead\n  ], options = {}) {\n    this._uas = userAgents.map((ua) => new RegExp(ua));\n    this.shouldRenderCache = {};\n    this.options = Object.assign({\n      cacheKey: (url) => url,\n    }, options);\n  }\n\n  get renderer() {\n    this._renderer = this._renderer || new SifrrSeo.Renderer(this._poptions, this.options);\n    return this._renderer;\n  }\n\n  get cache() {\n    this._cache = this._cache || getCache(this.options);\n    return this._cache;\n  }\n\n  getExpressMiddleware(getUrl = (expressReq) => `http://127.0.0.1:80${expressReq.originalUrl}`) {\n    return require('./middleware')(getUrl).bind(this);\n  }\n\n  addUserAgent(userAgent) {\n    this._uas.push(new RegExp(userAgent));\n  }\n\n  setPuppeteerOption(name, value) {\n    this._poptions = this._poptions || {};\n    this._poptions[name] = value;\n  }\n\n  close() {\n    return this.renderer.close();\n  }\n\n  shouldRender(url, headers) {\n    return this._isUserAgent(headers);\n  }\n\n  setShouldRenderCache(url, headers, val) {\n    const key = this.options.cacheKey(url, headers);\n    this.shouldRenderCache[key] = val;\n  }\n\n  getShouldRenderCache(url, headers) {\n    const key = this.options.cacheKey(url, headers);\n    if (this.shouldRenderCache[key] === undefined) return null;\n    return this.shouldRenderCache[key];\n  }\n\n  clearCache() {\n    this.cache.reset();\n  }\n\n  async render(url, headers) {\n    if (this.getShouldRenderCache(url, headers) === false) {\n      throw Error(`No Render`);\n    } else if (this.shouldRender(url, headers) && !this._isHeadless(headers)) {\n      const key = this.options.cacheKey(url, headers);\n      return new Promise((res, rej) => {\n        this.cache.get(key, (err, val) => {\n          /* istanbul ignore if */\n          if (err) {\n            rej(err);\n          } else if (!val) {\n            this.renderer.render(url, headers).then((resp) => {\n              this.cache.set(key, resp);\n              res(resp);\n            }).catch(/* istanbul ignore next */ err => {\n              rej(err);\n            });\n          } else {\n            res(val);\n          }\n        });\n      });\n    } else {\n      throw Error(`No Render`);\n    }\n  }\n\n  _isHeadless(headers = {}) {\n    return !!isHeadless.test(headers['user-agent']);\n  }\n\n  _isUserAgent(headers = {}) {\n    const ua = headers['user-agent'];\n    let ret = false;\n    this._uas.forEach((b) => {\n      if (b.test(ua)) ret = true;\n    });\n    return ret;\n  }\n}\n\nSifrrSeo.Renderer = Renderer;\n\nmodule.exports = SifrrSeo;\n"],"names":["PageRequest","Cache","require$$0","getCache","Renderer"],"mappings":"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"}