/*! Sifrr.Api v0.0.4 - sifrr project | MIT licensed | https://github.com/sifrr/sifrr */
import e from"graphql-sequelize";import t from"sequelize";import n from"graphql";import r from"fs";import o from"path";import i from"mkdirp";import s from"graphql-tools";var a=(e,t=", ",n=!1)=>{const r=[];for(let t in e)n&&e[t].description&&r.push(`"""${e[t].description}"""`),r.push(`${t}: ${e[t].type||e[t]}`);return r.join(t)},c=function(e,t){const n={};for(let r in e)t(r)&&(n[r]=e[r]);return n},u=(e,t=[],n=[])=>{n.length>0&&(e=c(e,e=>n.indexOf(e)>=0||t.indexOf(e)>=0));let r={};for(let n in e){let o,i=t.indexOf(n)>=0;e[n].returnType?o=e[n].returnType:e[n].type?"GraphQLList"===e[n].type.constructor.name?o=`[${e[n].type.ofType.name}]`:"GraphQLNonNull"===e[n].type.constructor.name?(o=e[n].type.ofType.name,i=!0):o=e[n].type.name?e[n].type.name:e[n].type.ofType&&e[n].type.ofType.name?e[n].type.ofType.name:e[n].type:o=e[n];const s=e[n].args?`(${a(e[n].args)})`:"";r[n+s]={type:o+(i?"!":"")},e[n].description&&(r[n+s].description=e[n].description)}return r};var l=class{constructor(e){this._attributes=e}addAttribute(e,t){this._attributes[e]=t}filterAttributes({allowed:e=[],required:t=[]}){this._allowedAttrs=e,this._reqAttrs=t}getFilteredAttributes({required:e=[],allowed:t=[]}){return u(this._attributes,e,t)}getResolvers(){const e={};for(let t in this._attributes)this._attributes[t].resolver&&(e[t]=this._attributes[t].resolver);return e}get attributes(){return this.getFilteredAttributes({required:this._reqAttrs,allowed:this._allowedAttrs})}get schemaPrefix(){return`${this.description?`""" ${this.description} """\n`:""}`}};var p=class extends l{constructor(e,t={},{queries:n={},mutations:r={}}){super(t),this.type=e,this.queries=n,this.mutations=r,this.connections=[],this._allowedAttrs=[],this._reqAttrs=[],this.description}addConnection(e,t){this.connections.push(t),this._attributes[e]=t}addQuery(e,t){this.queries[e]=t}addMutation(e,t){this.mutations[e]=t}getSchema(){return this.schemaPrefix+`type ${this.type} {\n  ${a(this.attributes,"\n  ",!0)}\n}`}};class d extends l{constructor(e,t,n,r){super({}),this.type=e,this.args=t,this.resolver=n,this.nodeType=r,this.description}clone(e){const t=new d(this.type,this.args,e,this.nodeType);return t._attributes=this._attributes,t.description=this.description,t}addArgument(e,t){this.args[e]=t}getSchema(){return this.schemaPrefix+`type ${this.type} {\n  edges: [${this.type+"Edge"}]\n  ${a(this.attributes,"\n  ",!0)}\n}\n\ntype ${this.type+"Edge"} {\n  node: ${this.nodeType}\n  cursor: String\n}`}}var f=d;function h(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function g(e,t){return e(t={exports:{}},t.exports),t.exports}var y=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.connectionArgs=t.backwardConnectionArgs=t.forwardConnectionArgs=void 0;var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};t.connectionDefinitions=function(e){var t=e.nodeType,o=e.name||t.name,i=e.edgeFields||{},c=e.connectionFields||{},u=e.resolveNode,l=e.resolveCursor,p=new n.GraphQLObjectType({name:o+"Edge",description:"An edge in a connection.",fields:function(){return r({node:{type:t,resolve:u,description:"The item at the end of the edge"},cursor:{type:new n.GraphQLNonNull(n.GraphQLString),resolve:l,description:"A cursor for use in pagination"}},s(i))}}),d=new n.GraphQLObjectType({name:o+"Connection",description:"A connection to a list of items.",fields:function(){return r({pageInfo:{type:new n.GraphQLNonNull(a),description:"Information to aid in pagination."},edges:{type:new n.GraphQLList(p),description:"A list of edges."}},s(c))}});return{edgeType:p,connectionType:d}};var o=t.forwardConnectionArgs={after:{type:n.GraphQLString},first:{type:n.GraphQLInt}},i=t.backwardConnectionArgs={before:{type:n.GraphQLString},last:{type:n.GraphQLInt}};t.connectionArgs=r({},o,i);function s(e){return"function"==typeof e?e():e}var a=new n.GraphQLObjectType({name:"PageInfo",description:"Information about pagination in a connection.",fields:function(){return{hasNextPage:{type:new n.GraphQLNonNull(n.GraphQLBoolean),description:"When paginating forwards, are there more items?"},hasPreviousPage:{type:new n.GraphQLNonNull(n.GraphQLBoolean),description:"When paginating backwards, are there more items?"},startCursor:{type:n.GraphQLString,description:"When paginating backwards, the cursor to continue."},endCursor:{type:n.GraphQLString,description:"When paginating forwards, the cursor to continue."}}}})});h(y);y.connectionArgs,y.backwardConnectionArgs,y.forwardConnectionArgs,y.connectionDefinitions;var m=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.base64=function(e){return Buffer.from(e,"utf8").toString("base64")},t.unbase64=function(e){return Buffer.from(e,"base64").toString("utf8")}});h(m);m.base64,m.unbase64;var b=g(function(e,t){function n(e,t){return r(e,t,{sliceStart:0,arrayLength:e.length})}function r(e,t,n){var r=t.after,o=t.before,s=t.first,c=t.last,u=n.sliceStart,l=n.arrayLength,p=u+e.length,d=a(o,l),f=a(r,-1),h=Math.max(u-1,f,-1)+1,g=Math.min(p,d,l);if("number"==typeof s){if(s<0)throw new Error('Argument "first" must be a non-negative integer');g=Math.min(g,h+s)}if("number"==typeof c){if(c<0)throw new Error('Argument "last" must be a non-negative integer');h=Math.max(h,g-c)}var y=e.slice(Math.max(h-u,0),e.length-(p-g)).map(function(e,t){return{cursor:i(h+t),node:e}}),m=y[0],b=y[y.length-1],v=r?f+1:0,O=o?d:l;return{edges:y,pageInfo:{startCursor:m?m.cursor:null,endCursor:b?b.cursor:null,hasPreviousPage:"number"==typeof c&&h>v,hasNextPage:"number"==typeof s&&g<O}}}Object.defineProperty(t,"__esModule",{value:!0}),t.connectionFromArray=n,t.connectionFromPromisedArray=function(e,t){return e.then(function(e){return n(e,t)})},t.connectionFromArraySlice=r,t.connectionFromPromisedArraySlice=function(e,t,n){return e.then(function(e){return r(e,t,n)})},t.offsetToCursor=i,t.cursorToOffset=s,t.cursorForObjectInConnection=function(e,t){var n=e.indexOf(t);if(-1===n)return null;return i(n)},t.getOffsetWithDefault=a;var o="arrayconnection:";function i(e){return(0,m.base64)(o+e)}function s(e){return parseInt((0,m.unbase64)(e).substring(o.length),10)}function a(e,t){if("string"!=typeof e)return t;var n=s(e);return isNaN(n)?t:n}});h(b);b.connectionFromArray,b.connectionFromPromisedArray,b.connectionFromArraySlice,b.connectionFromPromisedArraySlice,b.offsetToCursor,b.cursorToOffset,b.cursorForObjectInConnection,b.getOffsetWithDefault;var v=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};function o(e){return"function"==typeof e?e():e}t.mutationWithClientMutationId=function(e){var t=e.name,i=e.description,s=e.deprecationReason,a=e.inputFields,c=e.outputFields,u=e.mutateAndGetPayload,l=new n.GraphQLObjectType({name:t+"Payload",fields:function(){return r({},o(c),{clientMutationId:{type:n.GraphQLString}})}}),p=new n.GraphQLInputObjectType({name:t+"Input",fields:function(){return r({},o(a),{clientMutationId:{type:n.GraphQLString}})}});return{type:l,description:i,deprecationReason:s,args:{input:{type:new n.GraphQLNonNull(p)}},resolve:function(e,t,n,r){var o=t.input;return Promise.resolve(u(o,n,r)).then(function(e){return e.clientMutationId=o.clientMutationId,e})}}}});h(v);v.mutationWithClientMutationId;var O=g(function(e,t){function r(e,t){return(0,m.base64)([e,t].join(":"))}Object.defineProperty(t,"__esModule",{value:!0}),t.nodeDefinitions=function(e,t){var r=new n.GraphQLInterfaceType({name:"Node",description:"An object with an ID",fields:function(){return{id:{type:new n.GraphQLNonNull(n.GraphQLID),description:"The id of the object."}}},resolveType:t}),o={description:"Fetches an object given its ID",type:r,args:{id:{type:new n.GraphQLNonNull(n.GraphQLID),description:"The ID of an object"}},resolve:function(t,n,r,o){var i=n.id;return e(i,r,o)}},i={description:"Fetches objects given their IDs",type:new n.GraphQLNonNull(new n.GraphQLList(r)),args:{ids:{type:new n.GraphQLNonNull(new n.GraphQLList(new n.GraphQLNonNull(n.GraphQLID))),description:"The IDs of objects"}},resolve:function(t,n,r,o){var i=n.ids;return Promise.all(i.map(function(t){return Promise.resolve(e(t,r,o))}))}};return{nodeInterface:r,nodeField:o,nodesField:i}},t.toGlobalId=r,t.fromGlobalId=function(e){var t=(0,m.unbase64)(e),n=t.indexOf(":");return{type:t.substring(0,n),id:t.substring(n+1)}},t.globalIdField=function(e,t){return{description:"The ID of an object",type:new n.GraphQLNonNull(n.GraphQLID),resolve:function(n,o,i,s){return r(e||s.parentType.name,t?t(n,i,s):n.id)}}}});h(O);O.nodeDefinitions,O.toGlobalId,O.fromGlobalId,O.globalIdField;var w=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.pluralIdentifyingRootField=function(e){var t={},r=e.inputType;r instanceof n.GraphQLNonNull&&(r=r.ofType);return t[e.argName]={type:new n.GraphQLNonNull(new n.GraphQLList(new n.GraphQLNonNull(r)))},{description:e.description,type:new n.GraphQLList(e.outputType),args:t,resolve:function(t,n,r,o){var i=n[e.argName];return Promise.all(i.map(function(t){return Promise.resolve(e.resolveSingleInput(t,r,o))}))}}}});h(w);w.pluralIdentifyingRootField;var A=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"backwardConnectionArgs",{enumerable:!0,get:function(){return y.backwardConnectionArgs}}),Object.defineProperty(t,"connectionArgs",{enumerable:!0,get:function(){return y.connectionArgs}}),Object.defineProperty(t,"connectionDefinitions",{enumerable:!0,get:function(){return y.connectionDefinitions}}),Object.defineProperty(t,"forwardConnectionArgs",{enumerable:!0,get:function(){return y.forwardConnectionArgs}}),Object.defineProperty(t,"connectionFromArray",{enumerable:!0,get:function(){return b.connectionFromArray}}),Object.defineProperty(t,"connectionFromArraySlice",{enumerable:!0,get:function(){return b.connectionFromArraySlice}}),Object.defineProperty(t,"connectionFromPromisedArray",{enumerable:!0,get:function(){return b.connectionFromPromisedArray}}),Object.defineProperty(t,"connectionFromPromisedArraySlice",{enumerable:!0,get:function(){return b.connectionFromPromisedArraySlice}}),Object.defineProperty(t,"cursorForObjectInConnection",{enumerable:!0,get:function(){return b.cursorForObjectInConnection}}),Object.defineProperty(t,"cursorToOffset",{enumerable:!0,get:function(){return b.cursorToOffset}}),Object.defineProperty(t,"getOffsetWithDefault",{enumerable:!0,get:function(){return b.getOffsetWithDefault}}),Object.defineProperty(t,"offsetToCursor",{enumerable:!0,get:function(){return b.offsetToCursor}}),Object.defineProperty(t,"mutationWithClientMutationId",{enumerable:!0,get:function(){return v.mutationWithClientMutationId}}),Object.defineProperty(t,"nodeDefinitions",{enumerable:!0,get:function(){return O.nodeDefinitions}}),Object.defineProperty(t,"pluralIdentifyingRootField",{enumerable:!0,get:function(){return w.pluralIdentifyingRootField}}),Object.defineProperty(t,"fromGlobalId",{enumerable:!0,get:function(){return O.fromGlobalId}}),Object.defineProperty(t,"globalIdField",{enumerable:!0,get:function(){return O.globalIdField}}),Object.defineProperty(t,"toGlobalId",{enumerable:!0,get:function(){return O.toGlobalId}})});h(A);const{attributeFields:I,defaultListArgs:P,defaultArgs:j}=e,{resolver:T,createConnectionResolver:G}=e,{connectionArgs:L}=A;var M=class extends t.Model{static init(e){const t=super.init(this.schema,e);return t.graphqlModel=new p(t.name,I(t),{description:`${t.name} Model`}),t.graphqlConnection=new f(t.name+"Connection",L,G({target:t}).resolveConnection,t.graphqlModel.type),t.onInit(),t}static belongsToMany(e,t){const n=t.as||e.graphqlModel.type+"s";return this[n]=super.belongsToMany(e,t),this.graphqlModel.addConnection(n,e.graphqlConnection.clone(G({target:this[n]}).resolveConnection)),this[n]}static belongsTo(e,t){const n=t.as||e.graphqlModel.type;return this[n]=super.belongsTo(e,t),this.graphqlModel.addAttribute(n,{resolver:T(this[n]),returnType:e.graphqlModel.type,description:`${n} of ${this.name}`}),this[n]}static hasMany(e,t){const n=t.as||e.graphqlModel.type+"s";return this[n]=super.hasMany(e,t),this.graphqlModel.addConnection(n,e.graphqlConnection.clone(G({target:this[n]}).resolveConnection)),this[n]}static hasOne(e,t){const n=t.as||e.graphqlModel.type;return this[n]=super.hasOne(e,t),this.graphqlModel.addAttribute(n,{resolver:T(this[n]),returnType:e.graphqlModel.type,description:`${this.name}'s ${n}`}),this[n]}static addAttr(e,t){this.graphqlModel.addAttribute(e,t)}static gqAttrs(e){return this.graphqlModel.getFilteredAttributes(e)}static addQuery(e,t){this.graphqlModel.addQuery(e,t)}static addMutation(e,t){this.graphqlModel.addMutation(e,t)}static gqArgs({required:e,allowed:t}={}){return u(Object.assign(j(this),P()),e,t)}static getQueryResolver(e,t,n,r){const o=[];for(let e in t.where)if(e.indexOf("__")>=0){const n=e.split("__");t.where["$"+n.join(".")+"$"]=t.where[e],o.push(...this._assocsToInclude(n)),delete t.where[e]}return T(this,{before:e=>(e.include=o,e)})(e,t,n,r)}static createMutationResolver(e,t){const n=[];for(let e in t)if(e.indexOf("__")>=0){const r=e.split("__");t[r[0]]=t[r[0]]||{},t[r[0]][r[1]]=t[e],n.push(...this._assocsToInclude(r)),delete t[e]}return this.create(t,{include:n})}static updateMutationResolver(e,t){const n={where:{id:t.id}};return delete t.id,this.update(t,n).then(()=>this.findByPk(n.where.id))}static upsertMutationResolver(e,t){return this.upsert(t).then(()=>this.findByPk(t.id))}static deleteMutationResolver(e,t){return this.destroy({where:t})}static _assocsToInclude(e,t=!0,n=this){t&&e.pop();const r=e.shift(),o=[{association:n[r],as:r}];return e.length>0&&(o[0].include=this._assocsToInclude(e,!1,n[r].target)),o}};const{graphql:Q}=n;var F=class{constructor(e){this._schema=e,this._middlewares=[]}resolve(e,t,n={}){return Q({schema:this._schema,source:e,variableValues:t,contextValue:n})}};var q=function(e,t,{ignore:n=[],basePath:i=""}){const s=[];return r.readdirSync(t).filter(e=>".js"===o.extname(e)&&n.indexOf(e)<0).forEach(n=>{const r=function(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}(o.join(t,n));let a=r.basePath||"";delete r.basePath,"string"==typeof a&&(a=[a]),a.forEach(t=>{for(const n in r){const o=r[n];for(let r in o)e[n](i+t+r,o[r]),s.push(i+t+r)}})}),s},_={fileHeader:"# THIS FILE WAS AUTOGENERATED BY SIFRR-API. DO NOT EDIT THIS FILE DIRECTLY. \n",timestampHeader:`# Genarated at ${(new Date).toUTCString()} (${Date.now()}) \n`,fileSeparator:"#### Graphql Schema #### \n\n"};const{makeExecutableSchema:S}=s,{fileHeader:N,timestampHeader:C,fileSeparator:D}=_;function x(e,t){for(let n in e){const r=e[n];t[n]=r.resolver}return a(u(e),"\n  ",!0)}var $=function(e,{extra:t="",queries:n={},mutations:s={},schemaPath:a}={}){const c={},u=[],l={};for(let t in e){const r=e[t];u.push(r.getSchema()),Object.assign(n,r.queries),Object.assign(s,r.mutations),l[r.type]=l[r.type]||{},Object.assign(l[r.type],r.getResolvers()),r.connections.forEach(e=>{c[e.type]=e})}for(let e in c){const t=c[e];u.push(t.getSchema()),l[t.type]=l[t.type]||{},Object.assign(l[t.type],t.getResolvers())}const p={},d={},f=`type Query {\n  ${x(n,p)}\n}\n\ntype Mutation {\n  ${x(s,d)}\n}\n\nscalar SequelizeJSON\nscalar Date\n${t}`;if(u.unshift(f),l.Query=p,l.Mutation=d,a){i(o.dirname(a));const e=N+C+D,t=r.existsSync(a)?r.readFileSync(a,{encoding:"UTF-8"}).split(D)[1]:null,n=u.join("\n\n")+"\n";t!==n&&r.writeFileSync(a,e+n)}return S({typeDefs:u,resolvers:l})};var R=function(e,{allowed:t=[]}={}){let n={};Object.assign(n,e.query,e.body,e.params),t.length>0&&(n=c(n,e=>t.indexOf(e)>=0));for(let e in n)try{n[e]=JSON.parse(n[e])}catch(e){}return n};const E={};E.SequelizeModel=M,E.GraphqlExecutor=F,E.loadRoutes=q,E.createSchemaFromModels=$,E.reqToVariables=R;export default E;
/*! (c) @aadityataparia */
